# ``GeoMagSwift``

*English version → <doc:GeoMagSwift>*

GeoMagSwift 提供基于球谐系数（SHC）模型（如 IGRF、WMM）的快速离线地磁场计算。

## 概述

- 计算地磁场分量（北/东/下）、磁偏角、磁倾角与场强。
- 支持多代模型（IGRF/WMM/WMMHR）。
- 结果确定、适用于导航、制图与科研。
- 模型内置后可完全离线运行。

## SHCModel 说明（通俗版）

`SHCModel` 是对地球磁场的数学描述。你可以把它理解为一张“全球磁场地图”，输入时间和位置，就能得到该处的磁场数值。模型保存了若干个参考年份的系数，日期落在中间时就用插值计算。

它包含：

- `epochs`：参考年份列表，例如 `2020.0`、`2025.0`。
- `coefficients`：每个年份对应的高斯系数 `g(n,m)` 与 `h(n,m)`。
- `nmax`：模型的细致程度（越大越精细）。
- `validFrom` / `validTo`：建议使用的时间范围。

## 核心思想

先计算磁势（一个标量场），再对磁势求梯度得到磁场向量。你无需手算，库会自动完成，这里只是解释原理。

### 1) 磁势函数

```
V(r, θ, λ) = a * Σ(n=1..N) (a/r)^(n+1) Σ(m=0..n)
            [ g(n,m) cos(mλ) + h(n,m) sin(mλ) ] P(n,m)(cos θ)
```

符号含义（尽量直白）：

- `V`：磁势（一个标量）。
- `a`：地球参考半径（常数）。
- `r`：点到地心的距离。
- `θ`：余纬 = 90° − 纬度。
- `λ`：经度。
- `n, m`：展开的序号（细节层级）。
- `g(n,m), h(n,m)`：模型给出的系数。
- `P(n,m)`：缔合勒让德函数（特殊多项式）。
- `Σ`：求和符号（把所有项加起来）。

### 2) 由磁势得到磁场

```
B = -∇V
```

含义：磁场是磁势的空间变化率（负梯度）。

## 计算步骤（小白友好）

### 第 1 步：把日期变成十进制年份

比如 2025-07-01 会变成类似 `2025.5` 的数字，方便后续插值。

### 第 2 步：在相邻历元之间插值

假设模型有 2025.0 和 2030.0，而你的时间是 2027.5：

```
frac = (t - t0) / (t1 - t0)
value(t) = value(t0) + (value(t1) - value(t0)) * frac
```

- `t`：你的十进制年份
- `t0`, `t1`：左右两边的参考年份
- `frac`：在两者之间的位置（0 到 1）

### 第 3 步：计算磁场三分量

用插值后的系数做球谐合成，得到三分量：

- `X` = 北向分量
- `Y` = 东向分量
- `Z` = 向下分量

### 第 4 步：得到常用指标

```
H = sqrt(X^2 + Y^2)          // 水平强度
F = sqrt(H^2 + Z^2)          // 总强度
D = atan2(Y, X)              // 磁偏角
I = atan2(Z, H)              // 磁倾角
```

直观理解：

- `H`：水平面上的磁场强度
- `F`：整体磁场强度
- `D`：磁北与真北的夹角
- `I`：磁场向下倾斜的角度

### 第 5 步：长期变化（SV）

模型也给出每年的变化率。它通过相邻历元的差分得到导数，再传播到 `H`、`F`、`D`、`I`。

## Topics

### Models

- ``SHCModel``

### Results

- ``MagneticFieldSolution``
- ``MagneticFieldResult``
- ``MagneticFieldSecularVariation``
